<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Sentiment - Levoit Air Purifier Review Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="analyzeText.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="logo-container">
            <div class="logo-wrapper">
                <a href="index.html">
                    <img src="./Assets/leviot logo.png" alt="Levoit Logo" class="logo" />
                </a>
            </div>

            <nav class="nav-links">
                <a href="index.html#products" class="nav-link">Air Purifiers</a>
                <a href="index.html#tools" class="nav-link">Text Analysis</a>
                <a href="analyzeText.html" class="nav-link active">Review Analyzer</a>
            </nav>

            <div class="button-container">
                <a href="https://levoit.com/collections/air-purifiers" target="_blank">
                    <img src="./Assets/cart.png" class="cart-icon" alt="Shopping Cart" />
                </a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <h1>Test Our Sentiment Analyzer</h1>
            <p>Curious about how your words sound? Type anything in English below and discover the sentiment right away.
            </p>

            <div class="analyze-container">
                <div class="textbox-wrapper">
                    <textarea class="analyze-box" placeholder="Type your text here..." id="textInput"></textarea>
                    <span class="clear-btn" onclick="clearText()">Clear</span>
                </div>
                <button class="btn" onclick="analyzeText()">Analyze Text</button>


                <section class="results-section" id="results" style="display:none;">
                    <div class="sentiment-result">
                        <h3>Sentiment Analysis Result</h3>

                        <div id="gaugeIcon" class="emoji-top">
                            <i class="fa-solid fa-face-meh"></i>
                        </div>

                        <p id="sentimentText" class="sentiment-text"></p>

                        <div class="gauge-wrapper">
                            <canvas id="gaugeChart" width="320" height="200"></canvas>
                        </div>

                        <div class="gauge-legend">
                            <span class="legend-item"><span class="color-box negative"></span> Negative</span>
                            <span class="legend-item"><span class="color-box neutral"></span> Neutral</span>
                            <span class="legend-item"><span class="color-box positive"></span> Positive</span>
                        </div>

                    </div>
                </section>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 Levoit. All product photos and brand assets belong to Levoit.</p>
    </footer>


    <script>
        let gaugeChart;

        const gaugeNeedle = {
            id: 'gaugeNeedle',
            afterDatasetDraw(chart) {
                const { ctx } = chart;
                const needleAngle = chart.config.options.needleAngle;
                const cx = chart._metasets[0].data[0].x;
                const cy = chart._metasets[0].data[0].y;

                const needleLength = (chart.chartArea.height / 2) * 0.8;

                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(needleAngle);

                ctx.beginPath();
                ctx.moveTo(-3, 0);
                ctx.lineTo(0, -needleLength);
                ctx.lineTo(3, 0);
                ctx.closePath();
                ctx.fillStyle = "#000";
                ctx.fill();
                ctx.restore();

                // Center circle
                ctx.beginPath();
                ctx.arc(cx, cy, 8, 0, 2 * Math.PI);
                ctx.fillStyle = "#000";
                ctx.fill();
            }
        };

        function calculateNeedleAngle(negativeProb, neutralProb, positiveProb) {
            // Normalize to avoid floating rounding issues
            const total = negativeProb + neutralProb + positiveProb;
            const neg = negativeProb / total;
            const neu = neutralProb / total;
            const pos = positiveProb / total;

            console.log("Normalized probs:", { neg, neu, pos });

            const NEG_START = -90, NEG_END = -30;
            const NEU_START = -30, NEU_END = 30;
            const POS_START = 30, POS_END = 90;

            let dominantSentiment;
            if (pos >= neg && pos >= neu) dominantSentiment = "positive";
            else if (neg >= neu) dominantSentiment = "negative";
            else dominantSentiment = "neutral";

            let angleDeg = 0;
            if (dominantSentiment === "positive") {
                const relative = pos / (pos + neu + neg);
                angleDeg = POS_START + relative * (POS_END - POS_START);
            } else if (dominantSentiment === "negative") {
                const relative = neg / (pos + neu + neg);
                angleDeg = NEG_END - relative * (NEG_END - NEG_START);
            } else {
                angleDeg = 0;
                if (pos > neg) {
                    const lean = (pos - neg) * 50; // lean towards positive side
                    angleDeg = Math.min(25, lean);
                } else if (neg > pos) {
                    const lean = (neg - pos) * 50; // lean towards negative side
                    angleDeg = Math.max(-25, -lean);
                }
            }

            angleDeg = Math.max(-90, Math.min(90, angleDeg));
            console.log("Needle angle:", angleDeg);

            return (angleDeg * Math.PI) / 180;
        }

     async function analyzeText() {
    const text = document.getElementById('textInput').value.trim();
    if (!text) {
        alert("Please enter some text to analyze.");
        return;
    }

    try {
        // Call Hugging Face Space API
        const response = await fetch(
            "https://huggingface.co/spaces/gabb11/sentiment_analyzer/api/predict",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ data: [text] }) // HF Space expects {"data": [text]}
            }
        );

        // Hugging Face Space usually returns an array like ["positive"]
        const result = await response.json();
        const sentiment = result[0]; // extract string from array

        // Assign probabilities for gauge logic
        let negativeProb = 0, neutralProb = 0, positiveProb = 0;
        if (sentiment === "positive") positiveProb = 1;
        else if (sentiment === "neutral") neutralProb = 1;
        else negativeProb = 1;

        // Calculate confidence for display
        const confidence = (Math.max(negativeProb, neutralProb, positiveProb) * 100).toFixed(1);

        // Needle angle
        const needleAngle = calculateNeedleAngle(negativeProb, neutralProb, positiveProb);

        // Choose icon
        let iconHtml;
        if (sentiment === "negative") iconHtml = '<i class="fa-solid fa-face-frown" style="color:#F44336"></i>';
        else if (sentiment === "neutral") iconHtml = '<i class="fa-solid fa-face-meh" style="color:#FFC107"></i>';
        else iconHtml = '<i class="fa-solid fa-face-smile" style="color:#4CAF50"></i>';

        // Draw gauge chart
        const ctx = document.getElementById("gaugeChart").getContext("2d");
        if (gaugeChart) gaugeChart.destroy();

        gaugeChart = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Negative", "Neutral", "Positive"],
                datasets: [{
                    data: [1, 1, 1],
                    backgroundColor: ["#F44336", "#FFC107", "#4CAF50"],
                    borderWidth: 0
                }]
            },
            options: {
                rotation: -90,
                circumference: 180,
                cutout: "70%",
                needleAngle: needleAngle,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { enabled: false } }
            },
            plugins: [gaugeNeedle]
        });

        // Update frontend
        document.getElementById("gaugeIcon").innerHTML = iconHtml;
        document.getElementById("results").style.display = "block";
        document.getElementById("results").scrollIntoView({ behavior: "smooth", block: "center" });

        const sentimentText = document.getElementById("sentimentText");
        sentimentText.innerHTML = `
            <h3 style="color:${sentiment === "positive" ? "#4CAF50" : sentiment === "negative" ? "#F44336" : "#FFC107"}; margin-bottom: 15px;">
                ${sentiment.charAt(0).toUpperCase() + sentiment.slice(1)} Sentiment
            </h3>
            <p class="sentiment-text">
                This text is mostly composed with <b>${sentiment}</b> sentiment 
                <span>(${confidence}%)</span>.
            </p>
        `;
        sentimentText.className = "sentiment-text " + sentiment;

    } catch (err) {
        console.error(err);
        alert("Error connecting to Hugging Face Space API.");
    }
}


        // Clear button
        const textInput = document.getElementById("textInput");
        const clearBtn = document.querySelector(".clear-btn");

        textInput.addEventListener("input", () => {
            clearBtn.style.display = textInput.value ? "block" : "none";
        });

        function clearText() {
            textInput.value = "";
            clearBtn.style.display = "none";
            document.getElementById("results").style.display = "none";
        }

        // Enter key handler
        textInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault();
                analyzeText();
            }
        });
    </script>




</body>


</html>




