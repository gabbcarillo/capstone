<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Sentiment - Levoit Air Purifier Review Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="analyzeText.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="logo-container">
            <div class="logo-wrapper">
                <a href="index.html">
                    <img src="./Assets/leviot logo.png" alt="Levoit Logo" class="logo" />
                </a>
            </div>

            <nav class="nav-links">
                <a href="index.html#products" class="nav-link">Air Purifiers</a>
                <a href="index.html#tools" class="nav-link">Text Analysis</a>
                <a href="analyzeText.html" class="nav-link active">Review Analyzer</a>
            </nav>

            <div class="button-container">
                <a href="https://levoit.com/collections/air-purifiers" target="_blank">
                    <img src="./Assets/cart.png" class="cart-icon" alt="Shopping Cart" />
                </a>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <h1>Test Our Sentiment Analyzer</h1>
            <p>Curious about how your words sound? Type anything in English below and discover the sentiment right away.
            </p>

            <div class="analyze-container">
                <div class="textbox-wrapper">
                    <textarea class="analyze-box" placeholder="Type your text here..." id="textInput"></textarea>
                    <span class="clear-btn" onclick="clearText()">Clear</span>
                </div>
                <button class="btn" onclick="analyzeText()">Analyze Text</button>


                <section class="results-section" id="results" style="display:none;">
                    <div class="sentiment-result">
                        <h3>Sentiment Analysis Result</h3>

                        <div id="gaugeIcon" class="emoji-top">
                            <i class="fa-solid fa-face-meh"></i>
                        </div>

                        <p id="sentimentText" class="sentiment-text"></p>

                        <div class="gauge-wrapper">
                            <canvas id="gaugeChart" width="320" height="200"></canvas>
                        </div>

                        <div class="gauge-legend">
                            <span class="legend-item"><span class="color-box negative"></span> Negative</span>
                            <span class="legend-item"><span class="color-box neutral"></span> Neutral</span>
                            <span class="legend-item"><span class="color-box positive"></span> Positive</span>
                        </div>

                    </div>
                </section>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 Levoit. All product photos and brand assets belong to Levoit.</p>
    </footer>


   <script>
let gaugeChart;

// Gauge needle plugin
const gaugeNeedle = {
    id: 'gaugeNeedle',
    afterDatasetDraw(chart) {
        if (!chart.config.options.needleAngle) return;

        const { ctx } = chart;
        const needleAngle = chart.config.options.needleAngle;
        const meta = chart.getDatasetMeta(0);
        const { x: cx, y: cy } = meta.data[0].getCenterPoint();

        const needleLength = chart.chartArea.height / 2 * 0.8;

        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(needleAngle);

        ctx.beginPath();
        ctx.moveTo(-3, 0);
        ctx.lineTo(0, -needleLength);
        ctx.lineTo(3, 0);
        ctx.closePath();
        ctx.fillStyle = "#000";
        ctx.fill();
        ctx.restore();

        // Center circle
        ctx.beginPath();
        ctx.arc(cx, cy, 8, 0, 2 * Math.PI);
        ctx.fillStyle = "#000";
        ctx.fill();
    }
};

// Register plugin
Chart.register(gaugeNeedle);

// Convert sentiment probabilities to needle angle
function calculateNeedleAngle(negativeProb, neutralProb, positiveProb) {
    const total = negativeProb + neutralProb + positiveProb;
    const neg = negativeProb / total;
    const neu = neutralProb / total;
    const pos = positiveProb / total;

    // Map sentiment to angle: -90° (neg) → 0° (neu) → 90° (pos)
    return ((pos - neg) * 90 * Math.PI / 180);
}

async function analyzeText() {
    const text = document.getElementById('textInput').value.trim();
    if (!text) {
        alert("Please enter some text to analyze.");
        return;
    }

    try {
        const response = await fetch("https://huggingface.co/spaces/gabb11/sentiment-analyzer/api/predict/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: [text] }) // Hugging Face expects an array
        });

        const hfResult = await response.json();
        console.log("HF API response:", hfResult);

        // Hugging Face API may return { "data": [ { sentiment:..., probabilities:... } ] }
        const result = hfResult.data?.[0] || hfResult;

        const sentiment = result.sentiment;
        const confidence = result.confidence ? (result.confidence * 100).toFixed(1) : 0;
        const probabilities = result.probabilities || {};

        const negativeProb = probabilities.negative || 0;
        const neutralProb = probabilities.neutral || 0;
        const positiveProb = probabilities.positive || 0;

        // Choose icon
        let iconHtml = '<i class="fa-solid fa-face-meh" style="color:#FFC107"></i>'; // default neutral
        if (sentiment === "positive") iconHtml = '<i class="fa-solid fa-face-smile" style="color:#4CAF50"></i>';
        else if (sentiment === "negative") iconHtml = '<i class="fa-solid fa-face-frown" style="color:#F44336"></i>';

        // Update chart
        const ctx = document.getElementById("gaugeChart").getContext("2d");
        if (gaugeChart) gaugeChart.destroy();

        const needleAngle = calculateNeedleAngle(negativeProb, neutralProb, positiveProb);

        gaugeChart = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Negative", "Neutral", "Positive"],
                datasets: [{
                    data: [negativeProb, neutralProb, positiveProb],
                    backgroundColor: ["#F44336", "#FFC107", "#4CAF50"],
                    borderWidth: 0
                }]
            },
            options: {
                rotation: -90,
                circumference: 180,
                cutout: "70%",
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { enabled: false } },
                needleAngle: needleAngle // pass angle to plugin
            }
        });

        // Update UI
        document.getElementById("gaugeIcon").innerHTML = iconHtml;
        document.getElementById("results").style.display = "block";
        document.getElementById("results").scrollIntoView({ behavior: "smooth", block: "center" });

        const sentimentText = document.getElementById("sentimentText");
        sentimentText.innerHTML = `
            <h3 style="color:${sentiment === "positive" ? "#4CAF50" : sentiment === "negative" ? "#F44336" : "#FFC107"}; margin-bottom: 15px;">
                ${sentiment.charAt(0).toUpperCase() + sentiment.slice(1)} Sentiment
            </h3>
            <p class="sentiment-text">
                This text is mostly <b>${sentiment}</b> sentiment 
                <span>(${confidence}%)</span>.
            </p>
        `;
        sentimentText.className = "sentiment-text " + sentiment;

    } catch (err) {
        console.error("Frontend error:", err);
        alert("Failed to connect to Hugging Face Space API.");
    }
}
       // Clear button const textInput = document.getElementById("textInput"); const clearBtn = document.querySelector(".clear-btn"); textInput.addEventListener("input", () => { clearBtn.style.display = textInput.value ? "block" : "none"; }); function clearText() { textInput.value = ""; clearBtn.style.display = "none"; document.getElementById("results").style.display = "none"; } // Enter key handler textInput.addEventListener("keydown", (event) => { if (event.key === "Enter" && !event.shiftKey) { event.preventDefault(); analyzeText(); } });
</script>





</body>


</html>









